env:
  BACKEND_CONFIG: "backends\\backend.nonprod"
  VARFILE: "envs\\local"

# Terraform tasks
version: '3'
tasks:
  init:
    desc: Terraform init
    cmds:
      - terraform init -backend-config="{{.BACKEND_CONFIG}}.config"
  upgrade:
    desc: Terraform init (upgrade)
    cmds:
      - terraform init -upgrade -backend-config="{{.BACKEND_CONFIG}}.config"
  reconfigure:
    desc: Terraform init (reconfigure)
    cmds:
      - terraform init -reconfigure -backend-config="{{.BACKEND_CONFIG}}.config"
  validate:
    desc: Terraform validate
    cmds:
      - terraform validate
  plan:
    desc: 🚀 Terraform plan
    cmds:
      - terraform plan -var-file="{{.VARFILE}}.tfvars" -out=plan
      - terraform show -json plan > plan.tfgraph
  apply:
    desc: 🚀 Terraform apply
    cmds:
      - terraform apply -var-file="{{.VARFILE}}.tfvars"
  apply:approve:
    desc: 🚀 Terraform apply (auto-approve) from plan
    cmds:
      - terraform apply -var-file="{{.VARFILE}}.tfvars" -auto-approve
  destroy:
    desc: ❌ Terraform destroy
    cmds:
      - terraform destroy -var-file="{{.VARFILE}}.tfvars"
